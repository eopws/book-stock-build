{"version":3,"sources":["webpack:///./routes/book/index.js","webpack:///./components/ui/heart-btn/index.js","webpack:///./hooks/useAddBookToCart.js","webpack:///./routes/book/style.scss","webpack:///./api/books.js"],"names":["Book","id","useState","book","setBook","useEffect","fetchBook","getOneBook","ratingStars","i","push","rating","class","style","metaField__star","bookDescription","description","slice","onAddToCart","useAddBookToCart","onBuyBtnClick","useCallback","route","page","page__blackout","page__background","backgroundImage","bgImg","page__content","article","articleMeta","articleMeta__img","img","articleMeta__info","articleMetaInfo","metaField","metaField__key","metaField__value","name","author","year","metaField__starWrapper","map","item","ratingNumber","articleMetaInfo__footer","onClick","articleMetaInfo__price","salePrice","price","articleMetaInfo__salePrice","className","articleMetaInfo__heart","article__textWrapper","article__textTitle","article__text","HeartBtn","checked","authReducer","useSelector","state","dispatch","useDispatch","hasTryedAdd","setHasTryedAdd","addToCartCallback","onAdded","isAuthenticated","addElement","setPopupState","isAuthPopupOpen","getBooks","search","sortType","filters","pagination","onSale","Promise","resolve","setTimeout","paramsQuery","filterKey","perPage","filterValue","Object","Array","isArray","join","promise","axios","get","data"],"mappings":"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","file":"route-book.chunk.edefa.js","sourcesContent":["import { useCallback, useEffect, useState } from 'preact/hooks';\nimport style from './style.scss';\n\nimport { getOneBook } from '../../api/books';\nimport Button from '../../components/ui/button';\nimport useAddBookToCart from '../../hooks/useAddBookToCart';\nimport HeartBtn from '../../components/ui/heart-btn';\nimport { route } from 'preact-router';\n\nconst Book = ({ id }) => {\n    const [book, setBook] = useState(null);\n\n    useEffect(() => {\n        const fetchBook = async () => {\n            setBook(await getOneBook(id));\n        };\n\n        fetchBook();\n    }, []);\n\n    if (!book) {\n        return <>loading...</>;\n    }\n\n    const ratingStars = [];\n\n    for (let i = 0; i < 5; i++) {\n        if (book.rating > i) {\n            ratingStars.push(<i class={`icon-star ${style.metaField__star}`} />);\n        } else {\n            ratingStars.push(\n                <i class={`icon-star-empty ${style.metaField__star} ${style['metaField__star--empty']}`} />,\n            );\n        }\n    }\n\n    const bookDescription = (\n        <>\n            <p>{book.description.slice(0, 300)}</p>\n            <p>{book.description.slice(300, 700)}</p>\n            <p>{book.description.slice(700)}</p>\n        </>\n    );\n\n    const onAddToCart = useAddBookToCart(book);\n\n    const onBuyBtnClick = useCallback(() => onAddToCart(() => route('/cart')), []);\n\n    return (\n        <main class={style.page}>\n            <div class={`${style.page__blackout} _blackout _blackout--visible`} />\n\n            <div class={`${style.page__background} _ibg`} style={{ backgroundImage: `url(/${book.bgImg})` }} />\n\n            <div class={`${style.page__content} ${style.article} _container`}>\n                <div class={style.articleMeta}>\n                    <div class={`${style.articleMeta__img} _ibg`} style={{ backgroundImage: `url(/${book.img})` }} />\n\n                    <div class={`${style.articleMeta__info} ${style.articleMetaInfo}`}>\n                        <div class={style.metaField}>\n                            <span class={style.metaField__key}>Название :</span>\n                            <span class={style.metaField__value}>{book.name}</span>\n                        </div>\n\n                        <div class={style.metaField}>\n                            <span class={style.metaField__key}>Автор :</span>\n                            <span class={style.metaField__value}>{book.author}</span>\n                        </div>\n\n                        <div class={style.metaField}>\n                            <span class={style.metaField__key}>Год :</span>\n                            <span class={style.metaField__value}>{book.year}</span>\n                        </div>\n\n                        <div class={style.metaField}>\n                            <span class={style.metaField__key}>Рейтинг :</span>\n                            <div class={style.metaField__value}>\n                                <div class={style.metaField__starWrapper}>{ratingStars.map(item => item)}</div>\n                                <span class=\"rating-number\">{book.ratingNumber}</span>\n                            </div>\n                        </div>\n\n                        <div class={style.articleMetaInfo__footer}>\n                            <Button onClick={onBuyBtnClick}>Купить</Button>\n\n                            <span\n                                class={`${style.articleMetaInfo__price} ${\n                                    book.salePrice && style['articleMetaInfo__price--sale']\n                                }`}\n                            >\n                                {book.price} Р\n                            </span>\n                            {book.salePrice ? (\n                                <span class={style.articleMetaInfo__salePrice}>{book.salePrice} Р</span>\n                            ) : (\n                                ''\n                            )}\n\n                            <HeartBtn className={style.articleMetaInfo__heart} book={book} />\n                        </div>\n                    </div>\n                </div>\n\n                <div class={style.article__textWrapper}>\n                    <h3 class={style.article__textTitle}>Описание :</h3>\n\n                    <div class={style.article__text}>{bookDescription}</div>\n                </div>\n            </div>\n        </main>\n    );\n};\n\nexport default Book;\n","import useAddBookToCart from \"../../../hooks/useAddBookToCart\";\r\n\r\n\r\nconst HeartBtn = ({ className, checked, book }) => {\r\n    const onAddToCart = useAddBookToCart(book);\r\n\r\n    return (\r\n        <button\r\n            class={`${className} ${checked ? 'icon-heart' : 'icon-heart-empty'}`}\r\n            onClick={onAddToCart}\r\n        />\r\n    )\r\n}\r\n\r\nexport default HeartBtn\r\n","import { useCallback, useEffect, useState } from \"preact/hooks\";\r\nimport { useDispatch, useSelector } from \"react-redux\";\r\nimport { setPopupState } from \"../redux/reducers/AuthSlice\";\r\nimport { addElement } from \"../redux/reducers/CartSlice\";\r\n\r\nconst useAddBookToCart = book => {\r\n    const authReducer = useSelector(state => state.authReducer);\r\n    const dispatch = useDispatch();\r\n    const [hasTryedAdd, setHasTryedAdd] = useState(false);\r\n\r\n    const addToCartCallback = useCallback((onAdded) => {\r\n        if (!authReducer.isAuthenticated) {\r\n            dispatch(setPopupState(true));\r\n            setHasTryedAdd(true);\r\n        } else {\r\n            dispatch(addElement(book));\r\n            onAdded();\r\n        }\r\n    }, [authReducer.isAuthenticated, book]);\r\n\r\n    useEffect(() => {\r\n        if (hasTryedAdd) {\r\n            dispatch(addElement(book));\r\n            setHasTryedAdd(false);\r\n        }\r\n    }, [authReducer.isAuthenticated]);\r\n\r\n    useEffect(() => {\r\n        if (!authReducer.isAuthPopupOpen) {\r\n            setHasTryedAdd(false);\r\n        }\r\n    }, [authReducer.isAuthPopupOpen]);\r\n\r\n    return addToCartCallback;\r\n};\r\n\r\nexport default useAddBookToCart;\r\n","// extracted by mini-css-extract-plugin\nexport default {\"page\":\"page__wdGtf\",\"page__blackout\":\"page__blackout__3al1U\",\"page__background\":\"page__background__f49gZ\",\"page__content\":\"page__content__F0c1j\",\"article__textWrapper\":\"article__textWrapper__Btcdo\",\"article__textTitle\":\"article__textTitle__MXrRG\",\"article__text\":\"article__text__n2mnt\",\"articleMeta\":\"articleMeta__yEpYW\",\"articleMeta__img\":\"articleMeta__img__PH1I+\",\"articleMeta__info\":\"articleMeta__info__J0dNi\",\"articleMetaInfo__footer\":\"articleMetaInfo__footer__88aAm\",\"articleMetaInfo__price\":\"articleMetaInfo__price__ugF5l\",\"articleMetaInfo__price--sale\":\"articleMetaInfo__price--sale__t2Aa-\",\"articleMetaInfo__salePrice\":\"articleMetaInfo__salePrice__uEhl-\",\"articleMetaInfo__heart\":\"articleMetaInfo__heart__gLJR8\",\"metaField\":\"metaField__BbVMf\",\"metaField__key\":\"metaField__key__GKDHd\",\"metaField__value\":\"metaField__value__BBuyN\",\"metaField__starWrapper\":\"metaField__starWrapper__4R88S\",\"metaField__star\":\"metaField__star__A5ajA\",\"metaField__star--empty\":\"metaField__star--empty__yeMpK\"};","import axios from 'axios';\r\n\r\nexport const getBooks = ({ search = false, sortType = false, filters = {}, pagination = {}, onSale = false } = {}) =>\r\n    new Promise(resolve => {\r\n        // Delay for testing purposes\r\n        setTimeout(async () => {\r\n            let paramsQuery = '?';\r\n\r\n            paramsQuery += search ? `search=${search}&` : '';\r\n            paramsQuery += sortType ? `sortType=${sortType}&` : '';\r\n            paramsQuery += onSale ? `onSale=true&` : '';\r\n            paramsQuery += pagination ? `page=${pagination.page}&perPage=${pagination.perPage}&` : '';\r\n\r\n            for (const filterKey in filters) {\r\n                const filterValue = filters[filterKey];\r\n\r\n                if (filterValue !== Object(filterValue)) {\r\n                    paramsQuery += `${filterKey}=${filterValue}&`;\r\n                } else if (Array.isArray(filterValue)) {\r\n                    paramsQuery += `${filterKey}=${filterValue.join()}&`;\r\n                }\r\n            }\r\n\r\n            paramsQuery = paramsQuery.slice(0, -1);\r\n\r\n            const promise = await axios.get(`/api/books${paramsQuery}`);\r\n\r\n            resolve(promise.data);\r\n        }, 0);\r\n    });\r\n\r\nexport const getOneBook = (id) =>\r\n    new Promise(resolve => {\r\n        // Delay for testing purposes\r\n        setTimeout(async () => {\r\n            const promise = await axios.get(`/api/book/${id}`);\r\n\r\n            resolve(promise.data);\r\n        }, 1000);\r\n    });\r\n"],"sourceRoot":""}